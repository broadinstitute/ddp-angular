# JavaScript Node CircleCI 2.0 configuration file
#
# Check https://circleci.com/docs/2.0/language-javascript/ for more details
#
version: 2
jobs:
  build:
    docker:
      - image: broadinstitute/dsde-toolbox:consul-template-20-0.0.1
    working_directory: ~/repo
    steps:
      - checkout:
          path: ~/repo
      - run:
          name: Generating configuration files
          command: ruby configure.rb -y
          environment:
            OUTPUT_DIR: ddp-workspace/projects/ddp-osteo/output-config
            INPUT_DIR: config
            MANIFEST: manifest-study.rb
            USE_DOCKER: false
      - run: ls -l ddp-workspace/projects/ddp-osteo/output-config



#  build:
#    docker:
#      - image: broadinstitute/pepper-angular-toolkit:build_v1
#
#    working_directory: ~/repo
#
#    steps:
#      - run: |
#          echo $GCLOUD_SERVICE_KEY | gcloud auth activate-service-account --key-file=-
#          gcloud --quiet config set project ${GOOGLE_PROJECT_ID}
#          gcloud --quiet config set compute/zone ${GOOGLE_COMPUTE_ZONE}
#
#      - checkout:
#            path: ~/repo
#
##      - run: npm ci
#
#      - run: echo "The project is $PROJ"
#
#      - run:  gcloud --quiet app describe

#      - run:  VERSION=v1 ENV=dev OUTPUT_DIR=ddp-workspace/projects/output-config INPUT_DIR=ddp-workspace/projects/$PROJ STUDY_KEY=osteo STUDY_GUID=CMI-OSTEO ruby configure.rb -y

#      - run: ng build $PROJ --base-href=/ --output-path=dist/$PROJ --verbose=true --progress=true

      - run: ls -l ./dist/ddp-osteo/output-config
