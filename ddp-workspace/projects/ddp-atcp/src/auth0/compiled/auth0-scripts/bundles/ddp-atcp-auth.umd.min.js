!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports):"function"==typeof define&&define.amd?define("ddp-atcp-auth",["exports"],a):a((e=e||self)["ddp-atcp-auth"]={})}(this,(function(e){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function a(e,a){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var t,r,o=n.call(e),i=[];try{for(;(void 0===a||a-- >0)&&!(t=o.next()).done;)i.push(t.value)}catch(e){r={error:e}}finally{try{t&&!t.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i}var n,t="sign-up",r="reset-password",o="login",i="resend-instructions",s="forgot-password",c="activate-account",l=function(e){$(".path").addClass("not-visible"),$(".path."+e).removeClass("not-visible").addClass("visible")},u=function(){return l(o)},d=function(e,a){a?$(".NoticesModal--success").addClass("NoticesModal--danger"):$(".NoticesModal--success").removeClass("NoticesModal--danger"),e&&$("#modal-text").text(e),$("#message_modal").addClass("show"),n=setTimeout((function(){f()}),5e3)},f=function(){n&&clearTimeout(n),$("#message_modal").removeClass("show"),$(".NoticesModal--success").removeClass("NoticesModal--danger")},g=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*?&])[A-Za-z\d!@#$%^&**?&]{8,}$/,m=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;var p=[{name:"email",rules:"required|!callback_check_email"},{name:"password",rules:"required|min_length[8]|!callback_check_password"}],h={name:"check_email",validator:function(e){return m.test(e)}},v=function(e,a){var n=e.id,t=e.validators,r=e.customValidators,o=new FormValidator(n,t,(function(e,t){if(t.preventDefault(),$("#"+n+" .form-group").removeClass("error"),e.length>0)e.forEach((function(e){$("#"+n+" #"+e.name).closest(".form-group").addClass("error")}));else{var r=$("#"+n);a(r,r.serializeArray().reduce((function(e,a){return e[a.name]=a.value,e}),{}))}}));r&&r.forEach((function(e){o.registerCallback(e.name,e.validator)}))},w={signUp:{id:t,validators:function(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(a(arguments[n]));return e}(p,[{name:"password_confirm",rules:"required|matches[password]"}]),customValidators:[{name:"check_password",validator:function(e){return g.test(e)}},h]},login:{id:o,validators:[]},resetPassword:{id:r,validators:[{name:"newPassword",rules:"required|min_length[8]|!callback_check_password"},{name:"confirmNewPassword",rules:"required|matches[newPassword]"}],customValidators:[{name:"check_password",validator:function(e){return g.test(e)}},h]},resendInstructions:{id:i,validators:[p[0]],customValidators:[h]},forgetPassword:{id:s,validators:[p[0]]}};var y=function(){function e(e){this.baseUrl=e}return e.prototype.loadLanguages=function(){var e=this;$.getJSON(this.baseUrl+"/languages.json",(function(a){e.languages=a,e.populateLanguagesDropdown(),e.checkLangPreferences()}))},e.prototype.changeLanguage=function(e){var a=this;this.currentLangCode=e,window.localStorage.setItem("lang",e),$.getJSON(this.baseUrl+"/auth-"+e+".json",(function(e){a.currentDictionary=e,a.translateElements()}))},e.prototype.populateLanguagesDropdown=function(){var e=$(".container"),a="";this.languages.forEach((function(e){return a+='\n      <li>\n        <a\n          href="#"\n          class="green-hover change-language"\n          data-language="'+e.code.split("-")[0]+'"\n        >'+e.name+"</a>\n      </li>\n    "})),e.empty(),e.append(a)},e.prototype.checkLangPreferences=function(){var e=this;$(document).ready((function(){var a=window.localStorage.getItem("lang");if(a)return e.changeLanguage(a);if(config&&config.extraParams&&config.extraParams.language){var n=config.extraParams.language;return e.changeLanguage(n)}e.changeLanguage("en")}))},e.prototype.translateElements=function(){var e=this,a=this.languages.find((function(a){return a.code===e.currentLangCode}));a&&$("#current-language").text(a.name),$("[data-translate]").each((function(a,n){var t=$(n),r=t.data("translate"),o="";if(-1!==r.indexOf(".")){var i=r.split(".");try{o=i.reduce((function(e,a){return e[a]}),e.currentDictionary)}catch(e){console.log(e)}}else o=e.currentDictionary[r];t.text(o)}))},e}();var _,P,k=Array.isArray(config),x=function(e){return Array.isArray(e)?new auth0.WebAuth({domain:e[0],clientID:e[1],responseType:"token id_token"}):new auth0.WebAuth({domain:e.auth0Domain,clientID:e.clientID,redirectUri:e.callbackURL,responseType:e.internalOptions.response_type,params:e.internalOptions,configurationBaseUrl:e.clientConfigurationBaseUrl,scope:e.internalOptions.scope})}(config),C=k?config[3]:config.callbackURL,D=Math.max(C.indexOf("/auth"),C.indexOf("/login-landing")),L=new y((_=-1===D?C:C.substring(0,D))+"/assets/i18n");L.loadLanguages(),P=_,$(".prepare-link-host").map((function(e,a){var n=$(a);n.attr("href",P+n.attr("href"))})),$('[data-toggle="tooltip"]').tooltip({title:function(){return $(this).data("translate-tooltip").split(".").reduce((function(e,a){return e[a]}),L.currentDictionary)}}),k?v(w.resetPassword,(function(e){$.ajax({type:e.attr("method"),url:e.attr("action"),data:e.serialize(),success:function(e){d(L.currentDictionary.modal.SuccessChangedPassword),e.result_url&&window.location.assign(e.result_url.split("?")[0])},error:function(e){d(L.currentDictionary.modal.SuccessChangedPassword,!0)}})})):v(w.signUp,(function(e,a){var n=e.find("#email"),t=n.parent();t.removeClass("email-taken");var r="",o="";config.extraParams.first_name&&(r=config.extraParams.first_name),config.extraParams.last_name&&(o=config.extraParams.last_name),x.signup({connection:"Username-Password-Authentication",email:a.email,password:a.password,user_metadata:{temp_user_guid:config.extraParams.temp_user_guid,first_name:r,last_name:o}},(function(e){e?t.addClass("email-taken"):($("#enteredEmail").text(n.val()),l(c))}))})),v(w.login,(function(e,a){x.login({state:!k&&config.extraParams.state,realm:"Username-Password-Authentication",email:a.email,password:a.password},(function(){return d(L.currentDictionary.modal.InvalidLogin,!0)}))})),v(w.resendInstructions,(function(){})),v(w.forgetPassword,(function(e,a){x.changePassword({connection:"Username-Password-Authentication",email:a.email},(function(a){a?e.find(".form-group").addClass("error"):(d(L.currentDictionary.modal.YouWillGetInstructions),u())}))})),$(".onActivateForgotPassword").on("click",(function(e){e.preventDefault(),l(s)})),$(".onActivateResendInstructions").on("click",(function(e){e.preventDefault(),l(i)})),$(".onActivateSignIn").on("click",(function(e){e.preventDefault(),u()})),$(".hideModal").on("click",(function(e){e.preventDefault(),f()})),$(document).on("click",".change-language",(function(e){e.preventDefault(),L.changeLanguage($(e.currentTarget).data("language"))})),$("#google-sign").on("click",(function(e){e.preventDefault(),x.authorize({state:config.extraParams.state,redirectUri:C,connection:"google-oauth2"},(function(){}))})),$("#google").on("click",(function(e){e.preventDefault(),x.authorize({state:config.extraParams.state,redirectUri:C,connection:"google-oauth2"},(function(){}))})),k?l(r):"login"===config.extraParams.mode?u():l(t);var b=document.getElementsByClassName("FormItem-help");Array.from(b).forEach((function(e){return e.addEventListener("mouseenter",(function(){return function(e){return e.parentElement.getElementsByClassName("tooltip")[0].classList.add("in")}(e)}))})),Array.from(b).forEach((function(e){return e.addEventListener("mouseleave",(function(){return function(e){return e.parentElement.getElementsByClassName("tooltip")[0].classList.remove("in")}(e)}))}));e.api=null,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ddp-atcp-auth.umd.min.js.map