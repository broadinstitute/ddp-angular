!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define("ddp-atcp-auth",["exports"],n):n((e=e||self)["ddp-atcp-auth"]={})}(this,(function(e){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function n(e,n){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var t,o,r=a.call(e),s=[];try{for(;(void 0===n||n-- >0)&&!(t=r.next()).done;)s.push(t.value)}catch(e){o={error:e}}finally{try{t&&!t.done&&(a=r.return)&&a.call(r)}finally{if(o)throw o.error}}return s}var a,t="sign-up",o="reset-password",r="login",s="resend-instructions",i="forgot-password",c="activate-account",l=function(e){$(".path").addClass("not-visible"),$(".path."+e).removeClass("not-visible").addClass("visible")},u=function(){return l(r)},d=function(e,n){n?$(".NoticesModal--success").addClass("NoticesModal--danger"):$(".NoticesModal--success").removeClass("NoticesModal--danger"),e&&$("#modal-text").text(e),$("#message_modal").addClass("show"),a=setTimeout((function(){f()}),5e3)},f=function(){a&&clearTimeout(a),$("#message_modal").removeClass("show"),$(".NoticesModal--success").removeClass("NoticesModal--danger")},m=function(e){$('[data-toggle="tooltip"]').tooltip(),$(".prepare-link-host").map((function(n,a){var t=$(a);t.attr("href",e+t.attr("href"))}))},g=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*?&])[A-Za-z\d!@#$%^&**?&]{8,}$/,p=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;var h,v,w=[{name:"email",rules:"required|!callback_check_email"},{name:"password",rules:"required|min_length[8]|!callback_check_password"}],y={name:"check_email",validator:function(e){return p.test(e)}},k=function(e,n){var a=e.id,t=e.validators,o=e.customValidators,r=new FormValidator(a,t,(function(e,t){if(t.preventDefault(),$("#"+a+" .form-group").removeClass("error"),e.length>0)e.forEach((function(e){$("#"+a+" #"+e.name).closest(".form-group").addClass("error")}));else{var o=$("#"+a);n(o,o.serializeArray().reduce((function(e,n){return e[n.name]=n.value,e}),{}))}}));o&&o.forEach((function(e){r.registerCallback(e.name,e.validator)}))},_={signUp:{id:t,validators:function(){for(var e=[],a=0;a<arguments.length;a++)e=e.concat(n(arguments[a]));return e}(w,[{name:"password_confirm",rules:"required|matches[password]"}]),customValidators:[{name:"check_password",validator:function(e){return g.test(e)}},y]},login:{id:r,validators:[w[0],{name:"password",rules:"required|min_length[8]"}]},resetPassword:{id:o,validators:[{name:"newPassword",rules:"required|min_length[8]|!callback_check_password"},{name:"confirmNewPassword",rules:"required|matches[newPassword]"}],customValidators:[{name:"check_password",validator:function(e){return g.test(e)}},y]},resendInstructions:{id:s,validators:[w[0]],customValidators:[y]},forgetPassword:{id:i,validators:[w[0]]}},b=function(e){$("[data-translate]").each((function(n,a){var t=$(a),o=t.data("translate"),r="";if(-1!==o.indexOf(".")){var s=o.split(".");try{r=s.reduce((function(e,n){return e[n]}),e)}catch(e){console.log(e)}}else r=e[o];t.text(r)}))},A=function(e,n,a){$.getJSON(e+"/auth-"+n+".json",(function(e){b(e),a(e)}))},C=function(e){$.getJSON(e+"/languages.json",(function(e){var n=$(".languages"),a="";e.forEach((function(e){a+='<li><a class="green-hover change-language" href="#" data-language="'+e.code.split("-")[0]+'">'+e.name+"</a></li>"})),n.empty(),n.append(a)}))},P=Array.isArray(config),x=function(e){return Array.isArray(e)?new auth0.WebAuth({domain:e[0],clientID:e[1],responseType:"token id_token"}):new auth0.WebAuth({domain:e.auth0Domain,clientID:e.clientID,redirectUri:e.callbackURL,responseType:e.responseType,params:e.internalOptions,configurationBaseUrl:e.clientConfigurationBaseUrl})}(config),U=Math.max(config.callbackURL.indexOf("/auth"),config.callbackURL.indexOf("/login-landing"));h=-1===U?config.callbackURL:config.callbackURL.substring(0,U);var E,N,D=(E=P?config[3]:h+"/assets/i18n",N=function(e){v=e},C(E),{changeTranslate:function(e){return A(E,e,N)}});m(P?config[3]:h),P?k(_.resetPassword,(function(e){$.ajax({type:e.attr("method"),url:e.attr("action"),data:e.serialize(),success:function(){return d(v.modal.SuccessChangedPassword)}})})):k(_.signUp,(function(e,n){x.signup({connection:"Username-Password-Authentication",email:n.email,password:n.password,user_metadata:{temp_user_guid:config.extraParams.temp_user_guid}},(function(){$("#enteredEmail").text(e.find("#email").val()),l(c)}))})),k(_.login,(function(e,n){x.login({state:!P&&config.extraParams.state,realm:"Username-Password-Authentication",email:n.email,password:n.password},(function(){return d(v.modal.InvalidLogin,!0)}))})),k(_.resendInstructions,(function(){})),k(_.forgetPassword,(function(e,n){x.changePassword({connection:"Username-Password-Authentication",email:n.email},(function(n){n?e.find(".form-group").addClass("error"):d(v.modal.YouWillGetInstructions)}))})),$(".onActivateForgotPassword").on("click",(function(e){e.preventDefault(),l(i)})),$(".onActivateResendInstructions").on("click",(function(e){e.preventDefault(),l(s)})),$(".onActivateSignIn").on("click",(function(e){e.preventDefault(),u()})),$(".hideModal").on("click",(function(e){e.preventDefault(),f()})),$(document).on("click",".change-language",(function(e){e.preventDefault(),D.changeTranslate($(e.currentTarget).data("language"))})),D.changeTranslate("en"),$("#google-sign").on("click",(function(e){e.preventDefault(),x.popup.authorize({redirectUri:config.callbackURL,connection:"google"},(function(){}))})),P?l(o):"login"===config.extraParams.mode?u():l(t);var L=document.getElementsByClassName("FormItem-help");Array.from(L).forEach((function(e){return e.addEventListener("mouseenter",(function(){return function(e){return e.parentElement.getElementsByClassName("tooltip")[0].classList.add("in")}(e)}))})),Array.from(L).forEach((function(e){return e.addEventListener("mouseleave",(function(){return function(e){return e.parentElement.getElementsByClassName("tooltip")[0].classList.remove("in")}(e)}))}));e.api=null,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ddp-atcp-auth.umd.min.js.map